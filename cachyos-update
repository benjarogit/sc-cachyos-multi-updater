#!/bin/bash
#
# CachyOS Multi-Updater - Console Launcher
# Simple launcher script with menu for Setup or Update
#
# Copyright (c) 2024-2025 SunnyCueq
# Licensed under the MIT License (see LICENSE file)
#

set -euo pipefail

# Get script directory (where this file is located)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="${SCRIPT_DIR}/cachyos-multi-updater"

# Colors
COLOR_RESET='\033[0m'
COLOR_BOLD='\033[1m'
COLOR_CYAN='\033[0;36m'
COLOR_GREEN='\033[0;32m'
COLOR_YELLOW='\033[1;33m'

# Check if project directory exists
if [ ! -d "${PROJECT_DIR}" ]; then
    echo -e "${COLOR_YELLOW}âš ï¸  Projekt-Verzeichnis nicht gefunden: ${PROJECT_DIR}${COLOR_RESET}"
    echo -e "${COLOR_YELLOW}   Bitte stelle sicher, dass das Projekt korrekt installiert ist.${COLOR_RESET}"
    exit 1
fi

# Check if required scripts exist
if [ ! -f "${PROJECT_DIR}/setup.sh" ]; then
    echo -e "${COLOR_YELLOW}âš ï¸  setup.sh nicht gefunden in: ${PROJECT_DIR}${COLOR_RESET}"
    exit 1
fi

if [ ! -f "${PROJECT_DIR}/update-all.sh" ]; then
    echo -e "${COLOR_YELLOW}âš ï¸  update-all.sh nicht gefunden in: ${PROJECT_DIR}${COLOR_RESET}"
    exit 1
fi

# Show menu
clear
echo -e "${COLOR_BOLD}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${COLOR_RESET}"
echo -e "${COLOR_BOLD}  CachyOS Multi-Updater${COLOR_RESET}"
echo -e "${COLOR_BOLD}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${COLOR_RESET}"
echo ""
echo -e "${COLOR_CYAN}Bitte wÃ¤hlen Sie eine Option:${COLOR_RESET}"
echo ""
echo -e "  ${COLOR_GREEN}1)${COLOR_RESET} Setup durchfÃ¼hren (Erstinstallation)"
echo -e "  ${COLOR_GREEN}2)${COLOR_RESET} Updates starten"
echo -e "  ${COLOR_GREEN}3)${COLOR_RESET} Beenden"
echo ""
echo -e "${COLOR_CYAN}Ihre Wahl [1-3]:${COLOR_RESET} "
read -r choice

case "$choice" in
    1)
        echo ""
        echo -e "${COLOR_GREEN}ğŸš€ Starte Setup...${COLOR_RESET}"
        echo ""
        cd "${PROJECT_DIR}" || exit 1
        export SCRIPT_DIR="${PROJECT_DIR}"
        bash "${PROJECT_DIR}/setup.sh"
        ;;
    2)
        echo ""
        echo -e "${COLOR_GREEN}ğŸš€ Starte Updates...${COLOR_RESET}"
        echo ""
        cd "${PROJECT_DIR}" || exit 1
        export SCRIPT_DIR="${PROJECT_DIR}"
        bash "${PROJECT_DIR}/update-all.sh"
        ;;
    3)
        echo ""
        echo -e "${COLOR_YELLOW}Auf Wiedersehen!${COLOR_RESET}"
        exit 0
        ;;
    *)
        echo ""
        echo -e "${COLOR_YELLOW}âš ï¸  UngÃ¼ltige Auswahl. Bitte wÃ¤hlen Sie 1, 2 oder 3.${COLOR_RESET}"
        exit 1
        ;;
esac

